# é…ç½®æ–‡ä»¶è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨é…ç½®æ–‡ä»¶ç³»ç»Ÿå¿«é€Ÿåˆ›å»ºå’Œæ‰“åŒ…ä¸åŒçš„WebViewåº”ç”¨ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
/workspace/
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ build.app              # å½“å‰æ„å»ºçš„åº”ç”¨åç§°
â”‚   â”œâ”€â”€ app1/                  # åº”ç”¨1çš„é…ç½®å’Œèµ„æº
â”‚   â”‚   â”œâ”€â”€ app.cfg           # åº”ç”¨1çš„é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ loading.png       # Loadingé¡µé¢å›¾ç‰‡
â”‚   â”‚   â”œâ”€â”€ icon.png          # åº”ç”¨å›¾æ ‡
â”‚   â”‚   â””â”€â”€ splash.png        # å¯åŠ¨å±å¹•ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ app2/                  # åº”ç”¨2çš„é…ç½®å’Œèµ„æº
â”‚   â”‚   â”œâ”€â”€ app.cfg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...                    # æ›´å¤šåº”ç”¨é…ç½®
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ read-config.js         # è¯»å–é…ç½®è„šæœ¬
â”‚   â””â”€â”€ apply-config.js        # åº”ç”¨é…ç½®è„šæœ¬
â””â”€â”€ src/
    â””â”€â”€ config/
        â””â”€â”€ runtime.config.ts  # è¿è¡Œæ—¶é…ç½®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæ–°åº”ç”¨é…ç½®

åˆ›å»ºæ–°çš„åº”ç”¨é…ç½®ç›®å½•ï¼š

```bash
mkdir -p assets/myapp
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨ `assets/myapp/app.cfg` åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```properties
# åº”ç”¨åŸºæœ¬ä¿¡æ¯
appName=æˆ‘çš„åº”ç”¨
appDisplayName=MyApp
appId=com.mycompany.myapp
appVersion=1.0.0
buildNumber=1

# æ„å»ºé…ç½®
buildAndroid=true
buildIOS=true
isDebug=false

# WebViewé…ç½®
loadUrl=https://www.example.com
enableJavaScript=true
enableDOMStorage=true
enableCache=true

# Loadingé¡µé¢é…ç½®
loadingDuration=1000
loadingBackgroundColor=#4A90E2

# Androidç‰¹å®šé…ç½®
androidMinSdkVersion=21
androidTargetSdkVersion=34
androidCompileSdkVersion=34

# iOSç‰¹å®šé…ç½®
iosDeploymentTarget=13.0
iosBundleDisplayName=MyApp

# èµ„æºæ–‡ä»¶é…ç½®
appIcon=icon.png
loadingImage=loading.png
splashScreen=splash.png
```

### 3. æ·»åŠ èµ„æºæ–‡ä»¶

åœ¨ `assets/myapp/` ç›®å½•ä¸‹æ·»åŠ ï¼š
- **loading.png**: Loadingé¡µé¢æ˜¾ç¤ºçš„å›¾ç‰‡ï¼ˆå»ºè®®800x600ï¼‰
- **icon.png**: åº”ç”¨å›¾æ ‡ï¼ˆå»ºè®®1024x1024ï¼‰
- **splash.png**: å¯åŠ¨å±å¹•ï¼ˆå¯é€‰ï¼‰

### 4. æŒ‡å®šè¦æ„å»ºçš„åº”ç”¨

ç¼–è¾‘ `assets/build.app` æ–‡ä»¶ï¼Œå†™å…¥åº”ç”¨åç§°ï¼š

```
myapp
```

### 5. åº”ç”¨é…ç½®

```bash
npm run build:config
```

### 6. è¿è¡Œæˆ–æ‰“åŒ…

```bash
# è¿è¡ŒAndroid
npm run android

# è¿è¡ŒiOS
npm run ios

# æˆ–æ¨é€åˆ°GitHubè‡ªåŠ¨æ‰“åŒ…
git add .
git commit -m "Add myapp configuration"
git push
```

## ğŸ“‹ é…ç½®é¡¹è¯¦ç»†è¯´æ˜

### åº”ç”¨åŸºæœ¬ä¿¡æ¯

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹ | å¿…éœ€ |
|-------|------|------|------|
| `appName` | åº”ç”¨ä¸­æ–‡åç§° | `æˆ‘çš„WebView` | æ˜¯ |
| `appDisplayName` | åº”ç”¨æ˜¾ç¤ºåç§°ï¼ˆè‹±æ–‡ï¼‰ | `MyWebView` | æ˜¯ |
| `appId` | åº”ç”¨åŒ…å/Bundle ID | `com.mycompany.myapp` | æ˜¯ |
| `appVersion` | åº”ç”¨ç‰ˆæœ¬å· | `1.0.0` | æ˜¯ |
| `buildNumber` | æ„å»ºå·ï¼ˆæ•´æ•°ï¼‰ | `1` | æ˜¯ |

**æ³¨æ„äº‹é¡¹ï¼š**
- `appId` å¿…é¡»å”¯ä¸€ï¼Œæ ¼å¼ä¸ºåå‘åŸŸå
- `appId` ä¸€æ—¦ä¸Šæ¶å°±ä¸èƒ½æ›´æ”¹
- `buildNumber` æ¯æ¬¡å‘å¸ƒå¿…é¡»é€’å¢

### æ„å»ºé…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | å€¼ | é»˜è®¤ |
|-------|------|---|------|
| `buildAndroid` | æ˜¯å¦æ„å»ºAndroid | `true`/`false` | `true` |
| `buildIOS` | æ˜¯å¦æ„å»ºiOS | `true`/`false` | `true` |
| `isDebug` | è°ƒè¯•æ¨¡å¼ | `true`/`false` | `false` |

### WebViewé…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹ | é»˜è®¤ |
|-------|------|------|------|
| `loadUrl` | è¦åŠ è½½çš„URL | `https://www.baidu.com` | - |
| `enableJavaScript` | å¯ç”¨JavaScript | `true`/`false` | `true` |
| `enableDOMStorage` | å¯ç”¨DOMå­˜å‚¨ | `true`/`false` | `true` |
| `enableCache` | å¯ç”¨ç¼“å­˜ | `true`/`false` | `true` |

**æ”¯æŒçš„URLç±»å‹ï¼š**
- HTTP/HTTPSç½‘ç«™ï¼š`https://www.example.com`
- æœ¬åœ°HTMLï¼š`file:///android_asset/index.html`
- æ•°æ®URLï¼š`data:text/html,...`

### Loadingé¡µé¢é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹ | é»˜è®¤ |
|-------|------|------|------|
| `loadingDuration` | åœç•™æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ | `1000` | `1000` |
| `loadingBackgroundColor` | èƒŒæ™¯é¢œè‰² | `#4A90E2` | `#4A90E2` |

**é¢œè‰²æ ¼å¼ï¼š**
- åå…­è¿›åˆ¶ï¼š`#4A90E2`
- RGBï¼š`rgb(74, 144, 226)`
- é¢œè‰²åï¼š`blue`, `red`, `green`

### Androidç‰¹å®šé…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | æ¨èå€¼ |
|-------|------|--------|
| `androidMinSdkVersion` | æœ€ä½SDKç‰ˆæœ¬ | `21` (Android 5.0) |
| `androidTargetSdkVersion` | ç›®æ ‡SDKç‰ˆæœ¬ | `34` (Android 14) |
| `androidCompileSdkVersion` | ç¼–è¯‘SDKç‰ˆæœ¬ | `34` |

### iOSç‰¹å®šé…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | æ¨èå€¼ |
|-------|------|--------|
| `iosDeploymentTarget` | æœ€ä½iOSç‰ˆæœ¬ | `13.0` |
| `iosBundleDisplayName` | iOSæ˜¾ç¤ºåç§° | ä¸appDisplayNameç›¸åŒ |

### èµ„æºæ–‡ä»¶é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | æ–‡ä»¶å | å»ºè®®å°ºå¯¸ |
|-------|------|--------|----------|
| `loadingImage` | Loadingå›¾ç‰‡ | `loading.png` | 800x600 |
| `appIcon` | åº”ç”¨å›¾æ ‡ | `icon.png` | 1024x1024 |
| `splashScreen` | å¯åŠ¨å±å¹• | `splash.png` | 1242x2688 |

## ğŸ”§ é…ç½®è„šæœ¬è¯´æ˜

### æŸ¥çœ‹å½“å‰é…ç½®

```bash
npm run config:check
```

è¾“å‡ºç¤ºä¾‹ï¼š
```json
{
  "appName": "æˆ‘çš„WebView",
  "appVersion": "1.0.0",
  "loadUrl": "https://www.baidu.com",
  ...
}
```

### åº”ç”¨é…ç½®

```bash
npm run build:config
```

è¯¥å‘½ä»¤ä¼šï¼š
1. âœ… è¯»å– `assets/build.app` è·å–åº”ç”¨åç§°
2. âœ… è¯»å– `assets/{appName}/app.cfg` è·å–é…ç½®
3. âœ… ç”Ÿæˆ `src/config/runtime.config.ts`
4. âœ… æ›´æ–° `app.json`
5. âœ… æ›´æ–° Android é…ç½® (`build.gradle`, `strings.xml`)
6. âœ… æ›´æ–° iOS é…ç½® (`Info.plist`)
7. âœ… å¤åˆ¶èµ„æºæ–‡ä»¶

### è‡ªåŠ¨åº”ç”¨é…ç½®

è¿è¡Œ `npm run android` æˆ– `npm run ios` æ—¶ä¼šè‡ªåŠ¨åº”ç”¨é…ç½®ã€‚

## ğŸ“¦ å¤šåº”ç”¨ç®¡ç†

### ç¤ºä¾‹ï¼šç®¡ç†å¤šä¸ªåº”ç”¨

```
assets/
â”œâ”€â”€ build.app              # å½“å‰æ„å»ºï¼šapp1
â”œâ”€â”€ app1/                  # ç™¾åº¦åº”ç”¨
â”‚   â”œâ”€â”€ app.cfg
â”‚   â””â”€â”€ loading.png
â”œâ”€â”€ app2/                  # è°·æ­Œåº”ç”¨
â”‚   â”œâ”€â”€ app.cfg
â”‚   â””â”€â”€ loading.png
â””â”€â”€ app3/                  # å…¬å¸å†…éƒ¨åº”ç”¨
    â”œâ”€â”€ app.cfg
    â””â”€â”€ loading.png
```

### åˆ‡æ¢åº”ç”¨

åªéœ€ä¿®æ”¹ `assets/build.app`ï¼š

```bash
# æ„å»ºapp1
echo "app1" > assets/build.app
npm run build:config
npm run android

# åˆ‡æ¢åˆ°app2
echo "app2" > assets/build.app
npm run build:config
npm run android

# åˆ‡æ¢åˆ°app3
echo "app3" > assets/build.app
npm run build:config
npm run ios
```

## ğŸ¤– CI/CDè‡ªåŠ¨åŒ–

### GitHub Actionsé›†æˆ

GitHub Actionså·¥ä½œæµå·²è‡ªåŠ¨é›†æˆé…ç½®ç³»ç»Ÿï¼š

1. æ¨é€ä»£ç æ—¶è‡ªåŠ¨è¯»å– `assets/build.app`
2. åº”ç”¨å¯¹åº”çš„é…ç½®
3. æ„å»ºAndroidå’ŒiOSåŒ…

### æ„å»ºä¸åŒçš„åº”ç”¨

**æ–¹æ³•1ï¼šä¿®æ”¹build.appåæ¨é€**

```bash
echo "app1" > assets/build.app
git add assets/build.app
git commit -m "Build app1"
git push
```

**æ–¹æ³•2ï¼šä½¿ç”¨ä¸åŒåˆ†æ”¯**

```bash
# app1åˆ†æ”¯
git checkout -b build/app1
echo "app1" > assets/build.app
git add . && git commit -m "App1 config" && git push

# app2åˆ†æ”¯
git checkout -b build/app2
echo "app2" > assets/build.app
git add . && git commit -m "App2 config" && git push
```

**æ–¹æ³•3ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆé«˜çº§ï¼‰**

å¯ä»¥ä¿®æ”¹GitHub Actionså·¥ä½œæµï¼Œæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šåº”ç”¨ï¼š

```yaml
env:
  BUILD_APP: ${{ secrets.BUILD_APP_NAME || 'app1' }}
```

## ğŸ¨ è‡ªå®šä¹‰é…ç½®é¡¹

### æ·»åŠ æ–°çš„é…ç½®é¡¹

1. **åœ¨app.cfgä¸­æ·»åŠ é…ç½®**ï¼š

```properties
# è‡ªå®šä¹‰é…ç½®
myCustomConfig=myValue
showToolbar=true
theme=dark
```

2. **ä¿®æ”¹apply-config.js**ï¼š

```javascript
// åœ¨ generateRuntimeConfig å‡½æ•°ä¸­æ·»åŠ 
export const AppConfig = {
  // ... ç°æœ‰é…ç½®
  
  // è‡ªå®šä¹‰é…ç½®
  myCustomConfig: '${config.myCustomConfig || 'default'}',
  showToolbar: ${getConfigValue(config, 'showToolbar', false)},
  theme: '${config.theme || 'light'}',
};
```

3. **åœ¨ä»£ç ä¸­ä½¿ç”¨**ï¼š

```typescript
import AppConfig from '../config/runtime.config';

if (AppConfig.showToolbar) {
  // æ˜¾ç¤ºå·¥å…·æ 
}
```

## ğŸ“ é…ç½®æ–‡ä»¶æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

- **åº”ç”¨ç›®å½•å**ï¼šå°å†™å­—æ¯å’Œæ•°å­—ï¼Œä½¿ç”¨è¿å­—ç¬¦åˆ†éš”
  - âœ… `my-app`, `app1`, `company-portal`
  - âŒ `MyApp`, `app 1`, `å…¬å¸é—¨æˆ·`

- **é…ç½®æ–‡ä»¶å**ï¼šå›ºå®šä¸º `app.cfg`

- **èµ„æºæ–‡ä»¶å**ï¼šä½¿ç”¨æè¿°æ€§åç§°
  - âœ… `loading.png`, `icon.png`, `splash.png`
  - âŒ `1.png`, `image.png`, `pic.jpg`

### 2. ç‰ˆæœ¬ç®¡ç†

æ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼š

```properties
# å°ç‰ˆæœ¬æ›´æ–°ï¼ˆbugä¿®å¤ï¼‰
appVersion=1.0.1
buildNumber=2

# åŠŸèƒ½æ›´æ–°
appVersion=1.1.0
buildNumber=3

# é‡å¤§æ›´æ–°
appVersion=2.0.0
buildNumber=4
```

### 3. é…ç½®ç»„ç»‡

å»ºè®®æŒ‰åŠŸèƒ½åˆ†ç»„æ³¨é‡Šï¼š

```properties
# ===== åº”ç”¨ä¿¡æ¯ =====
appName=...

# ===== WebViewé…ç½® =====
loadUrl=...

# ===== ä¸»é¢˜é…ç½® =====
backgroundColor=...
```

### 4. æ•æ„Ÿä¿¡æ¯å¤„ç†

**ä¸è¦**åœ¨é…ç½®æ–‡ä»¶ä¸­å­˜å‚¨ï¼š
- APIå¯†é’¥
- å¯†ç 
- è¯ä¹¦ä¿¡æ¯

è¿™äº›åº”è¯¥ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–GitHub Secretsã€‚

## ğŸ› æ•…éšœæ’é™¤

### é…ç½®æœªç”Ÿæ•ˆ

```bash
# 1. æ¸…ç†å¹¶é‡æ–°åº”ç”¨é…ç½®
rm -rf src/config/runtime.config.ts
npm run build:config

# 2. æ¸…ç†æ„å»ºç¼“å­˜
cd android && ./gradlew clean && cd ..
rm -rf ios/build

# 3. é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules
npm install
```

### é…ç½®è¯»å–å¤±è´¥

æ£€æŸ¥ï¼š
1. `assets/build.app` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”ä¸ä¸ºç©º
2. `assets/{appName}/app.cfg` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
3. é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆ`key=value`ï¼‰
4. æ²¡æœ‰ä½¿ç”¨ä¸­æ–‡ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦

### Androidæ„å»ºå¤±è´¥

1. æ£€æŸ¥ `appId` æ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿ `versionCode` æ˜¯æ•´æ•°
3. æ¸…ç†Gradleç¼“å­˜ï¼š`cd android && ./gradlew clean`

### iOSæ„å»ºå¤±è´¥

1. æ£€æŸ¥ `Info.plist` æ˜¯å¦å­˜åœ¨
2. è¿è¡Œ `cd ios && pod install`
3. æ¸…ç†æ„å»ºï¼š`rm -rf ios/build`

## ğŸ“š ç¤ºä¾‹é…ç½®

é¡¹ç›®åŒ…å«ä¸¤ä¸ªç¤ºä¾‹é…ç½®ï¼š

### App1 - ç™¾åº¦åº”ç”¨
```bash
cat assets/app1/app.cfg
```

### App2 - è°·æ­Œåº”ç”¨
```bash
cat assets/app2/app.cfg
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹.md](./å¿«é€Ÿå¼€å§‹.md) - é¡¹ç›®å¿«é€Ÿå…¥é—¨
- [README.md](./README.md) - å®Œæ•´é¡¹ç›®è¯´æ˜
- [androidæ‰“åŒ…è¯´æ˜.md](./androidæ‰“åŒ…è¯´æ˜.md) - Androidæ‰“åŒ…æ•™ç¨‹
- [iosæ‰“åŒ…è¯´æ˜.md](./iosæ‰“åŒ…è¯´æ˜.md) - iOSæ‰“åŒ…æ•™ç¨‹

## ğŸ’¡ é«˜çº§æŠ€å·§

### æ‰¹é‡æ„å»ºå¤šä¸ªåº”ç”¨

åˆ›å»ºæ„å»ºè„šæœ¬ `build-all.sh`ï¼š

```bash
#!/bin/bash

apps=("app1" "app2" "app3")

for app in "${apps[@]}"
do
  echo "Building $app..."
  echo "$app" > assets/build.app
  npm run build:config
  cd android && ./gradlew assembleRelease && cd ..
  mv android/app/build/outputs/apk/release/app-release.apk "./releases/$app.apk"
done
```

### ç¯å¢ƒç‰¹å®šé…ç½®

åˆ›å»º `app.dev.cfg` å’Œ `app.prod.cfg`ï¼š

```bash
# å¼€å‘ç¯å¢ƒ
cp assets/app1/app.dev.cfg assets/app1/app.cfg
npm run build:config

# ç”Ÿäº§ç¯å¢ƒ
cp assets/app1/app.prod.cfg assets/app1/app.cfg
npm run build:config
```

---

**é…ç½®ç³»ç»Ÿç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025å¹´12æœˆ9æ—¥
